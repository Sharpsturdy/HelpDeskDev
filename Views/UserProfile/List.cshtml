@model IPagedList<Help_Desk_2.Models.UserProfile>

@{
    ViewBag.Title = "Inactive User Profiles";
}

<h2>@ViewBag.Title</h2>

@*{
    var db = new Help_Desk_2.DataAccessLayer.HelpDeskContext();
    var query = "SELECT * From UserProfile ORDER BY surName";
    //var data = db.Database.SqlQuery<Help_Desk_2.Models.UserProfile>(query);
    var data = db.UserProfiles.OrderBy(u => u.surName);
    //db.Database.SqlQuery()
    var grid = new WebGrid(data);
}

<div id="grid">
    
    @grid.GetHtml(
        columns: grid.Columns(
            grid.Column("FirstName", "First Name", @<text>@item.Value.firstName</text>, canSort: false),
            grid.Column("LastName", "Last Name", @<text>@item.Value.surName</text>, canSort: false),
            grid.Column("LastLogin", "Last Login", @<text>@item.Value.lastSignOn.ToString()</text>, canSort: false)
        )
    )
    
</div>
*@
<hr/>
@if (Model != null && Model.ItemEnd > 0)
{
<span style="font-size:small">Note: Deleting user profiles does not disable access to the application</span>
<table class="table table-bordered table-hover table-condensed table-view">
    <thead>
        <tr>
            <th>Name</th>
            <th>Email Address</th>
            <th>Days Inactive</th>
            <th>Last Login</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            @*<tr onclick="$(location).attr('href', '@Url.Action("Details", "UserProfile", new { @id = item.userID })')">*@
            <tr class="noclick">
                <td>
                    @Html.DisplayFor(modelItem => item.displayName)                    
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.emailAddress)
                </td>
                <td>
                    @Html.Raw(Math.Round((DateTime.Now - (DateTime)item.lastSignOn).TotalDays))
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.lastSignOn)
                </td>
                <td>
                @*<button type="submit" class="btn btn-default" name="btnDelete" value="@item.userID">Delete</button>*@
                    @using (Html.BeginForm())
                    {
                        @Html.AntiForgeryToken()
                            @*Html.Hidden(item.userID.ToString())*@
                        <input type="hidden" name="userID" value="@item.userID.ToString()" />
                        <input type="submit" value="Delete" class="btn btn-default" />

                    }
                </td>


            </tr>
        }
    </tbody>
</table>
<div class="pager">
    @Html.Pager(Model.PageSize, Model.PageNumber, Model.TotalItemCount).Options(o => o.AddRouteValue("searchType", @Request.QueryString["searchType"])
            .AddRouteValue("searchStr", @Request.QueryString["searchStr"])
            .DisplayFirstAndLastPage()
            .SetFirstPageText("First")
            .SetLastPageText("Last")
            .SetPreviousPageText("Prev")
            .SetNextPageText("Next"))

    <div class="text-muted">Displaying @Model.ItemStart - @Model.ItemEnd of @Model.TotalItemCount</div>
</div>
} else
{
    <p>No inactive profiles in the last 30 days</p>
}
